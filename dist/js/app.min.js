/*! 
* FUNP - v1.0.0 
* © Copyright 2016  Liangli Huang
 */
$(function(){var a="http://118.178.124.197:8080/",b=function(){if(null===sessionStorage.getItem("userName")||null===sessionStorage.getItem("timeStamp"))return!0;var a=!1,b=new Date,c=new Date(sessionStorage.getItem("timeStamp"));return c.setMinutes(c.getMinutes()+30),b.getTime()>c.getTime()&&(sessionStorage.removeItem("userName"),sessionStorage.removeItem("timeStamp"),a=!0),a},c=function(){var a=$("#loadingScreen"),b=a.width();a.css("margin-left",b>441?(b-441)/2:"0px"),$(window).resize(function(){var a=$("#loadingScreen"),b=a.width();a.css("margin-left",b>441?(b-441)/2:"0px")})},d=angular.module("app",["ngRoute"]);d.service("productBackAction",function(){var a=!1,b=null,c=null,d=null,e=null;return{getProductBack:function(){return a},getType:function(){return b},getPublishState:function(){return c},getProductRecommend:function(){return d},getProductCategory:function(){return e},setProductBack:function(b){a=b},setType:function(a){b=a},setPublishState:function(a){c=a},setProductRecommend:function(a){d=a},setProductCategory:function(a){e=a}}}),d.service("loginForwardURL",function(){var a=null;return{getForwardURL:function(){return a},setForwardURL:function(b){a=b}}}),d.directive("fileInput",["$parse",function(a){return{restrict:"A",link:function(b,c,d){c.bind("change",function(){a(d.fileInput).assign(b,c[0].files),b.$apply(),angular.element(this)[0].nextElementSibling.click()})}}}]),d.config(function(a){a.when("/login",{templateUrl:"app/views/common/login.html",controller:"loginCtrl"}).when("/logout",{templateUrl:"app/views/common/login.html",controller:"logoutCtrl"}).when("/primary_product",{templateUrl:"app/views/product/primary_product.html",controller:"primaryProductCtrl"}).when("/product_list",{templateUrl:"app/views/product/product_list.html",controller:"productListCtrl"}).when("/new_ar_product_detail/:productID",{templateUrl:"app/views/product/new_ar_product_detail.html",controller:"updateARProductDetail"}).when("/new_ar_product_detail",{templateUrl:"app/views/product/new_ar_product_detail.html",controller:"newARDetailCtrl"}).when("/new_video_product_detail/:productID",{templateUrl:"app/views/product/new_video_product_detail.html",controller:"updateVideoDetailCtrl"}).when("/new_video_product_detail",{templateUrl:"app/views/product/new_video_product_detail.html",controller:"newVideoDetailCtrl"}).when("/first_level_category",{templateUrl:"app/views/category/first_level_category.html",controller:"firstLevelCategoryCtrl"}).when("/second_level_category",{templateUrl:"app/views/category/second_level_category.html",controller:"secondLevelCategoryCtrl"}).when("/user_admin",{templateUrl:"app/views/user/user_admin.html",controller:"userAdminCtrl"}).when("/log_download",{templateUrl:"app/views/log/log_download.html",controller:"logDownloadCtrl"}).when("/system_info",{templateUrl:"app/views/log/system_info.html",controller:"systemInfoCtrl"}).otherwise("/primary_product",{templateUrl:"app/views/product/primary_product.html",controller:"otherUrlCtrl"})}),d.controller("primaryProductCtrl",function(c,d,e){return b()?(window.location.href="#login/",void e.setForwardURL("#primary_product")):(e.setForwardURL(null),c.productItems=[],c.layoutUpdate={entities:[]},d.get(a+"eden/prods/allprods").then(function(b){console.log("Get all product list successfully."),c.productItems=b.data,d.get(a+"eden/membs/unlogin").then(function(a){console.log("Get product layout"),angular.forEach(a.data.layoutDOs,function(a){var b={};b.layoutPosition=a.layoutPosition,b.layoutValue=a.layoutValue,c.layoutUpdate.entities.push(b),angular.forEach(c.productItems,function(b){null!==a.layoutValue&&b.id===a.layoutValue&&(1==a.layoutPosition?(c.mainProductOne=b,null!==c.mainProductOne.productCover&&"undefined"!=typeof c.mainProductOne.productCover&&$("#mainProductOneImage").attr("src",c.mainProductOne.productCover)):2==a.layoutPosition?(c.mainProductTwo=b,null!==c.mainProductTwo.productCover&&"undefined"!=typeof c.mainProductTwo.productCover&&$("#mainProductTwoImage").attr("src",c.mainProductTwo.productCover)):3==a.layoutPosition?(c.mainProductThree=b,null!==c.mainProductThree.productCover&&"undefined"!=typeof c.mainProductThree.productCover&&$("#mainProductThreeImage").attr("src",c.mainProductThree.productCover)):4==a.layoutPosition&&(c.mainProductFour=b,null!==c.mainProductFour.productCover&&"undefined"!=typeof c.mainProductFour.productCover&&$("#mainProductFourImage").attr("src",c.mainProductFour.productCover)))})}),0==c.layoutUpdate.entities.length&&(c.layoutUpdate={entities:[{layoutPosition:1,layoutValue:null},{layoutPosition:2,layoutValue:null},{layoutPosition:3,layoutValue:null},{layoutPosition:4,layoutValue:null}]})},function(a){console.log("Failed to get product layout")})},function(a){console.log("Failed to get product list by filter")}),c.mainProductOneChange=function(){var a=0;angular.forEach(c.layoutUpdate.entities,function(b){1==b.layoutPosition&&(c.layoutUpdate.entities[a].layoutValue=c.mainProductOne.id,$("#mainProductOneImage").attr("src",c.mainProductOne.productCover)),a++})},c.mainProductTwoChange=function(){var a=0;angular.forEach(c.layoutUpdate.entities,function(b){2==b.layoutPosition&&(c.layoutUpdate.entities[a].layoutValue=c.mainProductTwo.id,$("#mainProductTwoImage").attr("src",c.mainProductTwo.productCover)),a++})},c.mainProductThreeChange=function(){var a=0;angular.forEach(c.layoutUpdate.entities,function(b){3==b.layoutPosition&&(c.layoutUpdate.entities[a].layoutValue=c.mainProductThree.id,$("#mainProductThreeImage").attr("src",c.mainProductThree.productCover)),a++})},c.mainProductFourChange=function(){var a=0;angular.forEach(c.layoutUpdate.entities,function(b){4==b.layoutPosition&&(c.layoutUpdate.entities[a].layoutValue=c.mainProductFour.id,$("#mainProductFourImage").attr("src",c.mainProductFour.productCover)),a++})},void(c.saveLayout=function(){d.post(a+"eden/layout/updates",c.layoutUpdate).then(function(a){200==a.status?console.log("Update product layout successfully"):console.log("Failed to update product layout"),$("#updateLayoutModal").modal("hide")},function(a){console.log("Failed to update product layout"),$("#updateLayoutModal").modal("hide")})}))}),d.controller("productListCtrl",function(d,e,f,g){if(b())return window.location.href="#login/",void g.setForwardURL("#product_list");g.setForwardURL(null);var h=function(){angular.forEach(d.productItems,function(a){var b=a.productCategory.split(","),c=[];angular.forEach(b,function(a){angular.forEach(d.productCategoryItems,function(b){a==b.id&&c.push(b.categoryName)})}),a.productCategoryName=c.join(",")})};d.searchProductListByFilters=function(){console.log("Starting to search product items by filters..."),console.log("Selected product category: "+d.productCategory+" Selected index: "+$("#product_category").prop("selectedIndex")),console.log("Selected product type: "+d.productType+" Selected index: "+$("#product_type").prop("selectedIndex")),console.log("Selected publish state: "+d.publishState+" Selected index: "+$("#publish_state").prop("selectedIndex")),console.log("Selected recommendation: "+d.recommendation+" Selected index: "+$("#recommendation").prop("selectedIndex"));var b={};b.type=$("#product_type").prop("selectedIndex"),b.publishState=$("#publish_state").prop("selectedIndex"),b.productRecommend=$("#recommendation").prop("selectedIndex"),b.productCategory=d.productCategory.id,e.post(a+"eden/prods/lists",b).then(function(a){console.log("Get product list by filter successfully."),d.productItems=a.data,h(),d.productItems_copy=d.productItems,d.productItems_selected=[]},function(a){console.log("Failed to get product list by filter")})},d.cleanSearchProductListByFilters=function(){e.get(a+"eden/prods/allprods").then(function(a){console.log("Get all product list successfully."),d.productItems=a.data,h(),d.productItems_copy=d.productItems,d.productItems_selected=[]},function(a){console.log("Failed to get all product list")})};var i=function(){var b={};f.getProductBack()?(b.type=f.getType(),b.publishState=f.getPublishState(),b.productRecommend=f.getProductRecommend(),b.productCategory=d.productCategoryList[0].id,d.productCategory=d.productCategoryList[0],d.publishState=0==f.getPublishState()?"上架":"下架",d.productType=0==f.getType()?"视频产品":"AR产品",d.recommendation=0==f.getProductRecommend()?"是":"否",f.setProductBack(!1),e.post(a+"eden/prods/lists",b).then(function(a){console.log("Get product list by filter successfully."),d.productItems=a.data,h(),d.productItems_copy=d.productItems,d.productItems_selected=[]},function(a){console.log("Failed to get product list by filter")})):d.cleanSearchProductListByFilters()};d.checkALLYesNo=function(){console.log("Check all flag: "+d.checkAll);var a=$("input[name=mySelectedProduct]");if(a.prop("checked",d.checkAll),d.productItems_selected=[],d.checkAll)for(var b in d.productItems_copy)d.productItems_selected.push(d.productItems_copy[b]);console.log("Current selected number: "+d.productItems_selected.length)},d.checkItem=function(a){if(console.log("Check item flag: "+a.checked),a.checked)d.productItems_selected.push(a);else for(var b in d.productItems_selected)d.productItems_selected[b].id==a.id&&d.productItems_selected.splice(b,1);console.log("Current selected number: "+d.productItems_selected.length);var c=$("#allCheckControl");0==d.productItems_selected.length?c.prop("checked",!1):d.productItems_selected.length==d.productItems_copy.length&&c.prop("checked",!0)},d.actionClickModal=function(a){console.log("Click button: "+a),d.actionSelected=a},d.actionConfirm=function(){console.log("Confirm action: "+d.actionSelected),angular.forEach(d.productItems_selected,function(b){e.get(a+"eden/prods/opes/"+d.actionSelected+"/"+b.id).then(function(a){console.log(d.actionSelected+" product: "+b.name+" successfully"),$(confirmDiag).modal("hide");var c=$("#allCheckControl");c.prop("checked",!1),d.searchProductListByFilters()},function(a){console.log("Failed to "+d.actionSelected+" product: "+b.name)})})},d.productItems=null,d.productItems_selected=[],d.actionSelected="",d.productItems_copy=[],c(),d.productCategoryItems=[],d.productCategoryList=[{id:0,name:"全部"}],d.productCategory=d.productCategoryList[0],d.publishState="上架",d.productType="视频产品",d.recommendation="是",e.get(a+"eden/cates/list/levelone").then(function(a){console.log("Get all product category list successfully"),d.productCategoryItems=a.data;for(var b in a.data){var c={};c.id=a.data[b].id,c.name=a.data[b].categoryName,d.productCategoryList.push(c)}i()},function(a){console.log("Failed to get product category list")})}),d.controller("updateARProductDetail",function(c,d,e,f,g){if(b())return window.location.href="#login/",void g.setForwardURL("#new_ar_product_detail/"+e.productID);g.setForwardURL(null),console.log("Product ID: "+e.productID),c.firstScreenShot="",c.secondScreenShot="",c.thirdScreenShot="",c.productCategory=[];var h=function(){d.get(a+"eden/prods/"+e.productID).then(function(a){console.log("Success to get AR product item: "+e.productID),c.productInfo=a.data;var b=a.data.productImages.split(",");c.firstScreenShot="undefined"==typeof b[0]?"":b[0],c.secondScreenShot="undefined"==typeof b[1]?"":b[1],c.thirdScreenShot="undefined"==typeof b[2]?"":b[2];var d=a.data.media.split(",");d.indexOf("电子书")>=0?c.mediaTypeElectricBook=!0:c.mediaTypeElectricBook=!1,d.indexOf("书籍")>=0?c.mediaTypeBook=!0:c.mediaTypeBook=!1,d.indexOf("卡牌")>=0?c.mediaTypeCard=!0:c.mediaTypeCard=!1,d.indexOf("教具")>=0?c.mediaTypeTeachTool=!0:c.mediaTypeTeachTool=!1,d.indexOf("益智玩具")>=0?c.mediaTypeIntelligentToy=!0:c.mediaTypeIntelligentToy=!1,d.indexOf("其它")>=0?c.mediaTypeOther=!0:c.mediaTypeOther=!1,c.productInfo.productAppEnabled=0==c.productInfo.productAppEnabled,c.productInfo.productPlayEnabled=0==c.productInfo.productPlayEnabled,c.productInfo.productTrialEnabled=0==c.productInfo.productTrialEnabled;var f=a.data.productMatchScope.split(",");f.indexOf("3")>=0?c.threeYearsOld=!0:c.threeYearsOld=!1,f.indexOf("4")>=0?c.fourYearsOld=!0:c.fourYearsOld=!1,f.indexOf("5")>=0?c.fiveYearsOld=!0:c.fiveYearsOld=!1,f.indexOf("6")>=0?c.sixYearsOld=!0:c.sixYearsOld=!1,f.indexOf("7")>=0?c.sevenYearsOld=!0:c.sevenYearsOld=!1;var g=a.data.productCategory.split(",");c.productCategorySelected=[],angular.forEach(c.productCategoryItems,function(a){angular.forEach(g,function(b){b==a.id&&c.productCategorySelected.push(a)})}),c.productCategory=c.productCategorySelected},function(a){console.log("Failed to get AR product item")})},i=function(){d.get(a+"eden/cates/list/levelone").then(function(a){c.productCategoryItems=a.data,a.data.length>0&&(c.productCategory.push(a.data[0]),console.log("Success to get all product category")),h()},function(a){console.log("Failed to get all product category")})};i();var j=function(b,e,f){console.log("Selected file number: "+b.length);var g=new FormData;g.append("root",b[0]),d.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?c.productInfo.productDesc=a.data.urls:"cover"==f?c.productInfo.productCover=a.data.urls:"firstScreen"==f?c.firstScreenShot=a.data.urls:"secondScreen"==f?c.secondScreenShot=a.data.urls:"thirdScreen"==f?c.thirdScreenShot=a.data.urls:"trial"==f?c.productInfo.productTrialAddr=a.data.urls:"QRCode"==f&&(c.productInfo.productMicroStoreByecodeAddr=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};c.updateProductDescriptionImage=function(){j(c.productDescriptionImageFile,"productDescImage","description")},c.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},c.updateProductCoverImage=function(){j(c.productCoverImageFile,"productCoverImage","cover")},c.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},c.updateProductCoverImageHori=function(){j(c.productCoverImageHoriFile,"productCoverImageHori","coverHori")},c.updateProductCoverImageHoriStart=function(){$(productCoverFileSelectHori).click(),console.log("Click product horizontal cover file selection dialog")},c.updateProductCoverImageVerti=function(){j(c.productCoverImageVertiFile,"productCoverImageVerti","coverVerti")},c.updateProductCoverImageVertiStart=function(){$(productCoverFileSelectVerti).click(),console.log("Click product vertical cover file selection dialog")},c.updateFirstScreenShotImage=function(){j(c.firstScreenShotFile,"productScreenShotFirstImage","firstScreen")},c.updateFirstScreenShotImageStart=function(){$("#productScreenShotFirstFileSelect").click(),console.log("Click the first product screen shot file selection dialog")},c.updateSecondScreenShotImage=function(){j(c.secondScreenShotFile,"productScreenShotSecondImage","secondScreen")},c.updateSecondScreenShotImageStart=function(){$("#productScreenShotSecondFileSelect").click(),console.log("Click the second product screen shot file selection dialog")},c.updateThirdScreenShotImage=function(){j(c.thirdScreenShotFile,"productScreenShotThirdImage","thirdScreen")},c.updateThirdScreenShotImageStart=function(){$("#productScreenShotThirdFileSelect").click(),console.log("Click the third product screen shot file selection dialog")},c.updateProductTrialImage=function(){j(c.productTrialFile,"productTrialImage","trial")},c.updateProductTrialImageStart=function(){$("#productTrialFileSelect").click(),console.log("Click product trial file selection dialog")},c.updateProductQRImage=function(){j(c.productQRFile,"productQRImage","QRCode")},c.updateProductQRImageStart=function(){$("#productQRFileSelect").click(),console.log("Click product QR code image file selection dialog")};var k=function(b){console.log("Selected file number: "+b.length);var e=new FormData;e.append("root",b[0]),d.post(a+"eden/prods/upload",e,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload APK file successfully"),c.productInfo.productApkDownUrl=a.data.urls):console.log("Failed to upload APK file")},function(a){console.log("Failed to upload APK file")})};c.updateAPKFile=function(){k(c.apkFile)},c.updateAPKFileStart=function(){$("#apkFileSelect").click(),console.log("Click APK file selection dialog")},c.submitProductInfo=function(){c.productInfo.productCategory=c.productCategory.map(function(a){return a.id}).join(",")+",";var b=[];b.push(c.mediaTypeElectricBook?"电子书":""),b.push(c.mediaTypeBook?"书籍":""),b.push(c.mediaTypeCard?"卡牌":""),b.push(c.mediaTypeTeachTool?"教具":""),b.push(c.mediaTypeIntelligentToy?"益智玩具":""),b.push(c.mediaTypeOther?"其它":""),c.productInfo.media=b.map(function(a){if(""!=a)return a}).join(",");var e=[];e.push(c.threeYearsOld?"3":""),e.push(c.fourYearsOld?"4":""),e.push(c.fiveYearsOld?"5":""),e.push(c.sixYearsOld?"6":""),e.push(c.sevenYearsOld?"7":""),c.productInfo.productMatchScope=e.map(function(a){if(""!=a)return a}).join(",");var g=[];""!==c.firstScreenShot&&g.push(c.firstScreenShot),""!==c.secondScreenShot&&g.push(c.secondScreenShot),""!==c.thirdScreenShot&&g.push(c.thirdScreenShot),c.productInfo.productImages=g.map(function(a){return a}).join(","),c.productInfo.productModifyDate=new Date,c.productInfo.productAppEnabled=c.productInfo.productAppEnabled?0:1,c.productInfo.productPlayEnabled=c.productInfo.productPlayEnabled?0:1,c.productInfo.productTrialEnabled=c.productInfo.productTrialEnabled?0:1,d.post(a+"eden/prods/update",c.productInfo).then(function(a){200===a.status?(console.log("Update AR product item successfully"),f.setProductBack(!0),f.setType(c.productInfo.type),f.setPublishState(c.productInfo.publishState),f.setProductRecommend(c.productInfo.productRecommend),f.setProductCategory("全部"),window.location.href="#product_list/"):(alert("更新AR产品失败！返回码："+a.status),console.log("Failed to update AR product item "))},function(a){alert("更新AR产品失败！返回码："+a.status),console.log("Failed to update AR product item ")})}}),d.controller("newARDetailCtrl",function(c,d,e,f){if(b())return window.location.href="#login/",void f.setForwardURL("#new_ar_product_detail");f.setForwardURL(null),c.productInfo={},c.productInfo.productCover="",c.productInfo.productCoverHori="",c.productInfo.productCoverVerti="",c.productInfo.productTrialAddr="",c.productInfo.productApkDownUrl="",c.productInfo.productMicroStoreByecodeAddr="",c.firstScreenShot="",c.secondScreenShot="",c.thirdScreenShot="",c.mediaTypeElectricBook=!0,c.threeYearsOld=!0,c.fourYearsOld=!0,c.productCategory=[],c.imageInvalid=!1,d.get(a+"eden/cates/list/levelone").then(function(a){c.productCategoryItems=a.data,a.data.length>0&&(c.productCategory.push(a.data[0]),console.log("Success to get all product category"))},function(a){console.log("Failed to get all product category")});var g=function(b,e,f){console.log("Selected file number: "+b.length);var g=new FormData;g.append("root",b[0]),d.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?c.productInfo.productDesc=a.data.urls:"cover"==f?c.productInfo.productCover=a.data.urls:"coverHori"==f?c.productInfo.productCoverHori=a.data.urls:"coverVerti"==f?c.productInfo.productCoverVerti=a.data.urls:"firstScreen"==f?c.firstScreenShot=a.data.urls:"secondScreen"==f?c.secondScreenShot=a.data.urls:"thirdScreen"==f?c.thirdScreenShot=a.data.urls:"trial"==f?c.productInfo.productTrialAddr=a.data.urls:"QRCode"==f&&(c.productInfo.productMicroStoreByecodeAddr=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};c.updateProductDescriptionImage=function(){g(c.productDescriptionImageFile,"productDescImage","description")},c.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},c.updateProductCoverImage=function(){g(c.productCoverImageFile,"productCoverImage","cover")},c.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},c.updateProductCoverImageHori=function(){g(c.productCoverImageHoriFile,"productCoverImageHori","coverHori")},c.updateProductCoverImageHoriStart=function(){$(productCoverFileSelectHori).click(),console.log("Click product horizontal cover file selection dialog")},c.updateProductCoverImageVerti=function(){g(c.productCoverImageVertiFile,"productCoverImageVerti","coverVerti")},c.updateProductCoverImageVertiStart=function(){$(productCoverFileSelectVerti).click(),console.log("Click product vertical cover file selection dialog")},c.updateFirstScreenShotImage=function(){g(c.firstScreenShotFile,"productScreenShotFirstImage","firstScreen")},c.updateFirstScreenShotImageStart=function(){$("#productScreenShotFirstFileSelect").click(),console.log("Click the first product screen shot file selection dialog")},c.updateSecondScreenShotImage=function(){g(c.secondScreenShotFile,"productScreenShotSecondImage","secondScreen")},c.updateSecondScreenShotImageStart=function(){$("#productScreenShotSecondFileSelect").click(),console.log("Click the second product screen shot file selection dialog")},c.updateThirdScreenShotImage=function(){g(c.thirdScreenShotFile,"productScreenShotThirdImage","thirdScreen")},c.updateThirdScreenShotImageStart=function(){$("#productScreenShotThirdFileSelect").click(),console.log("Click the third product screen shot file selection dialog")},c.updateProductTrialImage=function(){g(c.productTrialFile,"productTrialImage","trial")},c.updateProductTrialImageStart=function(){$("#productTrialFileSelect").click(),console.log("Click product trial file selection dialog")},c.updateProductQRImage=function(){g(c.productQRFile,"productQRImage","QRCode")},c.updateProductQRImageStart=function(){$("#productQRFileSelect").click(),console.log("Click product QR code image file selection dialog")};var h=function(b){console.log("Selected file number: "+b.length);var e=new FormData;e.append("root",b[0]),d.post(a+"eden/prods/upload",e,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload APK file successfully"),c.productInfo.productApkDownUrl=a.data.urls):console.log("Failed to upload APK file")},function(a){console.log("Failed to upload APK file")})};c.updateAPKFile=function(){h(c.apkFile)},c.updateAPKFileStart=function(){$("#apkFileSelect").click(),console.log("Click APK file selection dialog")},c.submitProductInfo=function(){if(null==c.productInfo.productDesc||0==c.productInfo.productCover.length||0==c.productInfo.productCoverHori.length||0==c.productInfo.productCoverVerti.length||0==c.firstScreenShot.length)return void(c.imageInvalid=!0);c.imageInvalid=!1,c.productInfo.type=1,c.productInfo.publishState=1,c.productInfo.productRecommend=1,c.productInfo.productCategory=c.productCategory.map(function(a){return a.id}).join(",")+",";var b=[];b.push(c.mediaTypeElectricBook?"电子书":""),b.push(c.mediaTypeBook?"书籍":""),b.push(c.mediaTypeCard?"卡牌":""),b.push(c.mediaTypeTeachTool?"教具":""),b.push(c.mediaTypeIntelligentToy?"益智玩具":""),b.push(c.mediaTypeOther?"其它":""),c.productInfo.media=b.map(function(a){if(""!=a)return a}).join(",");var f=[];f.push(c.threeYearsOld?"3":""),f.push(c.fourYearsOld?"4":""),f.push(c.fiveYearsOld?"5":""),f.push(c.sixYearsOld?"6":""),f.push(c.sevenYearsOld?"7":""),c.productInfo.productMatchScope=f.map(function(a){if(""!=a)return a}).join(","),c.productInfo.productImages="";var g=[];""!==c.firstScreenShot&&g.push(c.firstScreenShot),""!==c.secondScreenShot&&g.push(c.secondScreenShot),""!==c.thirdScreenShot&&g.push(c.thirdScreenShot),c.productInfo.productImages=g.map(function(a){return a}).join(","),c.productInfo.productUploadDate=new Date,c.productInfo.productModifyDate=new Date,c.productInfo.productAppEnabled=c.productInfo.productAppEnabled?0:1,c.productInfo.productPlayEnabled=c.productInfo.productPlayEnabled?0:1,c.productInfo.productTrialEnabled=c.productInfo.productTrialEnabled?0:1,d.post(a+"eden/prods/add",c.productInfo).then(function(a){200===a.status?(console.log("Create AR product item successfully"),e.setProductBack(!0),e.setType(c.productInfo.type),e.setPublishState(c.productInfo.publishState),e.setProductRecommend(c.productInfo.productRecommend),e.setProductCategory("全部"),window.location.href="#product_list/"):(alert("创建AR产品失败！返回码："+a.status),console.log("Failed to create AR product item "))},function(a){alert("创建AR产品失败！返回码："+a.status),console.log("Failed to create AR product item ")})}}),d.controller("updateVideoDetailCtrl",function(c,d,e,f,g){if(b())return window.location.href="#login/",void g.setForwardURL("#new_video_product_detail/"+e.productID);g.setForwardURL(null),c.productCategory=[];var h=function(){d.get(a+"eden/prods/"+e.productID).then(function(a){c.productInfo=a.data;var b=a.data.media.split(",");b.indexOf("电子书")>=0?c.mediaTypeElectricBook=!0:c.mediaTypeElectricBook=!1,b.indexOf("书籍")>=0?c.mediaTypeBook=!0:c.mediaTypeBook=!1,b.indexOf("卡牌")>=0?c.mediaTypeCard=!0:c.mediaTypeCard=!1,b.indexOf("教具")>=0?c.mediaTypeTeachTool=!0:c.mediaTypeTeachTool=!1,b.indexOf("益智玩具")>=0?c.mediaTypeIntelligentToy=!0:c.mediaTypeIntelligentToy=!1,b.indexOf("其它")>=0?c.mediaTypeOther=!0:c.mediaTypeOther=!1;var d=a.data.productMatchScope.split(",");d.indexOf("3")>=0?c.threeYearsOld=!0:c.threeYearsOld=!1,d.indexOf("4")>=0?c.fourYearsOld=!0:c.fourYearsOld=!1,d.indexOf("5")>=0?c.fiveYearsOld=!0:c.fiveYearsOld=!1,d.indexOf("6")>=0?c.sixYearsOld=!0:c.sixYearsOld=!1,d.indexOf("7")>=0?c.sevenYearsOld=!0:c.sevenYearsOld=!1;var e=a.data.productCategory.split(",");c.productCategorySelected=[],angular.forEach(c.productCategoryItems,function(a){angular.forEach(e,function(b){b==a.id&&c.productCategorySelected.push(a)})}),c.productCategory=c.productCategorySelected},function(a){console.log("Failed to get AR product item")})},i=function(){d.get(a+"eden/cates/list/levelone").then(function(a){c.productCategoryItems=a.data,a.data.length>0&&(c.productCategory.push(a.data[0]),console.log("Success to get all product category")),h()},function(a){console.log("Failed to get all product category")})};i();var j=function(b,e,f){console.log("Selected file number: "+b.length);var g=new FormData;g.append("root",b[0]),d.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?c.productInfo.productDesc=a.data.urls:"cover"==f&&(c.productInfo.productCover=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};c.updateProductDescriptionImage=function(){j(c.productDescriptionImageFile,"productDescImage","description")},c.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},c.updateProductCoverImage=function(){j(c.productCoverImageFile,"productCoverImage","cover")},c.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},c.selectVideoItem=function(a){c.videoItemSelected=a},c.delVideoItem=function(){for(var a in c.productInfo.videoDOs){var b=c.productInfo.videoDOs.indexOf(c.videoItemSelected);b>-1&&(c.productInfo.videoDOs.splice(b,1),console.log("Delete video item index: "+b))}$(deleteVideoItemModal).modal("hide")},c.newVideoItem=function(){var a={};a.videoName=c.videoName,a.videoUrl=c.videoUrl,c.productInfo.videoDOs.push(a),$(newVideoItemModal).modal("hide")},c.submitProductInfo=function(){c.productInfo.productModifyDate=new Date,c.productInfo.productCategory=c.productCategory.map(function(a){return a.id}).join(",")+",";var b=[];b.push(c.mediaTypeElectricBook?"电子书":""),b.push(c.mediaTypeBook?"书籍":""),b.push(c.mediaTypeCard?"卡牌":""),b.push(c.mediaTypeTeachTool?"教具":""),b.push(c.mediaTypeIntelligentToy?"益智玩具":""),b.push(c.mediaTypeOther?"其它":""),c.productInfo.media=b.map(function(a){if(""!=a)return a}).join(",");var e=[];e.push(c.threeYearsOld?"3":""),e.push(c.fourYearsOld?"4":""),e.push(c.fiveYearsOld?"5":""),e.push(c.sixYearsOld?"6":""),e.push(c.sevenYearsOld?"7":""),c.productInfo.productMatchScope=e.map(function(a){if(""!=a)return a}).join(","),d.post(a+"eden/prods/update",c.productInfo).then(function(a){200===a.status?(console.log("Update video product item successfully, go back to product list page..."),f.setProductBack(!0),f.setType(c.productInfo.type),f.setPublishState(c.productInfo.publishState),f.setProductRecommend(c.productInfo.productRecommend),f.setProductCategory("全部"),window.location.href="#product_list/"):(alert("更新视频产品失败！返回码："+a.status),console.log("Failed to update video product item"))},function(a){alert("更新视频产品失败！返回码："+a.status),console.log("Failed to update video product item ")})}}),d.controller("newVideoDetailCtrl",function(c,d,e,f){if(b())return window.location.href="#login/",void f.setForwardURL("#new_video_product_detail");f.setForwardURL(null),c.productInfo={},c.productInfo.productCover="",c.productInfo.productCoverVerti="",c.productInfo.videoDOs=[],c.mediaTypeElectricBook=!0,c.threeYearsOld=!0,c.fourYearsOld=!0,c.productCategory=[],c.imageInvalid=!1,d.get(a+"eden/cates/list/levelone").then(function(a){c.productCategoryItems=a.data,a.data.length>0&&(c.productCategory.push(a.data[0]),console.log("Success to get all product category"))},function(a){console.log("Failed to get all product category")});var g=function(b,e,f){console.log("Selected file number: "+b.length);var g=new FormData;g.append("root",b[0]),d.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?c.productInfo.productDesc=a.data.urls:"cover"==f?c.productInfo.productCover=a.data.urls:"coverVerti"==f&&(c.productInfo.productCoverVerti=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};c.updateProductDescriptionImage=function(){g(c.productDescriptionImageFile,"productDescImage","description")},c.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},c.updateProductCoverImage=function(){g(c.productCoverImageFile,"productCoverImage","cover")},c.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},c.updateProductCoverImageVerti=function(){g(c.productCoverImageVertiFile,"productCoverImageVerti","coverVerti")},c.updateProductCoverImageVertiStart=function(){$(productCoverFileSelectVerti).click(),console.log("Click product vertical cover file selection dialog")},c.selectVideoItem=function(a){c.videoItemSelected=a},c.delVideoItem=function(){for(var a in c.productInfo.videoDOs){var b=c.productInfo.videoDOs.indexOf(c.videoItemSelected);b>-1&&(c.productInfo.videoDOs.splice(b,1),console.log("Delete video item index: "+b))}$(deleteVideoItemModal).modal("hide")},c.newVideoItem=function(){var a={};a.videoName=c.videoName,a.videoUrl=c.videoUrl,c.productInfo.videoDOs.push(a),$(newVideoItemModal).modal("hide")},c.submitProductInfo=function(){if(null==c.productInfo.productDesc||0==c.productInfo.productCover.length||0==c.productInfo.productCoverVerti.length)return void(c.imageInvalid=!0);c.imageInvalid=!1,c.productInfo.type=0,c.productInfo.publishState=1,c.productInfo.productRecommend=1,c.productInfo.productCategory=c.productCategory.map(function(a){return a.id}).join(",")+",";var b=[];b.push(c.mediaTypeElectricBook?"电子书":""),b.push(c.mediaTypeBook?"书籍":""),b.push(c.mediaTypeCard?"卡牌":""),
b.push(c.mediaTypeTeachTool?"教具":""),b.push(c.mediaTypeIntelligentToy?"益智玩具":""),b.push(c.mediaTypeOther?"其它":""),c.productInfo.media=b.map(function(a){if(""!=a)return a}).join(",");var f=[];f.push(c.threeYearsOld?"3":""),f.push(c.fourYearsOld?"4":""),f.push(c.fiveYearsOld?"5":""),f.push(c.sixYearsOld?"6":""),f.push(c.sevenYearsOld?"7":""),c.productInfo.productMatchScope=f.map(function(a){if(""!=a)return a}).join(","),c.productInfo.productUploadDate=new Date,c.productInfo.productModifyDate=new Date,d.post(a+"eden/prods/add",c.productInfo).then(function(a){200===a.status?(console.log("Create video product item successfully"),e.setProductBack(!0),e.setType(c.productInfo.type),e.setPublishState(c.productInfo.publishState),e.setProductRecommend(c.productInfo.productRecommend),e.setProductCategory("全部"),window.location.href="#product_list/"):(alert("创建视频产品失败！返回码："+a.status),console.log("Failed to create video product item "))},function(a){alert("创建视频产品失败！返回码："+a.status),console.log("Failed to create video product item ")})}}),d.controller("firstLevelCategoryCtrl",function(d,e,f){return b()?(window.location.href="#login/",void f.setForwardURL("#first_level_category")):(f.setForwardURL(null),d.firstLevelCategoryItems=null,c(),firstLevelCategoryItems_temp=[],e.get(a+"eden/cates/list/levelone").then(function(a){d.firstLevelCategoryItems=a.data,firstLevelCategoryItems_temp=d.firstLevelCategoryItems},function(a){console.log("Failed to get the first level category")}),d.searchByCategory=function(){if(null===d.firstLevelCategoryItems)return void console.log("The first level category is empty");d.firstLevelCategoryItems=[];var a=new RegExp(d.firstCategorySearch,"i");for(var b in firstLevelCategoryItems_temp)a.test(firstLevelCategoryItems_temp[b].categoryName)&&d.firstLevelCategoryItems.push(firstLevelCategoryItems_temp[b])},d.updateItem=function(a){d.currentUpdateItem=a,d.levelOneCategoryName=a.categoryName},d.updateFirstCategory=function(){console.log("Update the first level category: "+d.levelOneCategoryName),d.currentUpdateItem.categoryName=d.levelOneCategoryName,e.post(a+"eden/cates/update",d.currentUpdateItem).then(function(b){console.log("Update first category item successfully."),$(updateFirstCategoryModal).modal("hide"),e.get(a+"eden/cates/list/levelone").then(function(a){d.firstLevelCategoryItems=a.data},function(a){console.log("Failed to get the first level category")})},function(a){console.log("Failed to update first category item ")})},d.deleteItem=function(a){d.selectedFirstLevelCategoryID=a.id,d.selectedFirstLevelCategoryItem=a},d.deleteFirstCategory=function(){e.get(a+"eden/cates/delete/"+d.selectedFirstLevelCategoryID).then(function(b){200===b.status?(console.log("Success to delete the first level category ID: "+d.selectedFirstLevelCategoryID),e.get(a+"eden/cates/list/levelone").then(function(a){$(deleteFirstCategoryModal).modal("hide"),d.firstLevelCategoryItems=a.data},function(a){console.log("Failed to get the first level category")})):(alert("删除产品分类失败！返回码："+b.status),console.log("Failed to delete product category item "))},function(a){alert("删除产品分类失败！返回码："+a.status),console.log("Failed to delete product category item")})},void(d.createFirstCategory=function(){var b={};b.categoryName=d.newFirstCategoryName,b.categoryUpdateDate=new Date,b.categoryLevel=1,b.categoryDeleted=0,e.post(a+"eden/cates/add",b).then(function(b){console.log("Create first category item successfully."),$(newFirstCategoryModal).modal("hide"),e.get(a+"eden/cates/list/levelone").then(function(a){d.firstLevelCategoryItems=a.data},function(a){console.log("Failed to get the first level category"),alert("创建产品分类失败！")})},function(a){console.log("Failed to create first category item "),alert("创建产品分类失败！")})}))}),d.controller("userAdminCtrl",function(d,e,f){return b()?(window.location.href="#login/",void f.setForwardURL("#user_admin")):(f.setForwardURL(null),d.userItems=null,c(),console.log("Invoke user admin controller, get user admin list data"),e.get(a+"eden/membs/lists").then(function(a){d.userItems=a.data,userItems_temp=a.data},function(a){console.log("Failed to get admin user list")}),d.searchUserListByPhone=function(){d.userItems=[];var a=new RegExp(d.searchPhoneNumber,"i");for(var b in userItems_temp)a.test(userItems_temp[b].memberMobile)&&d.userItems.push(userItems_temp[b])},d.resetPWD=function(a){d.selectedUserID=a.id,d.selectedUserItem=a,console.log("Selected user id: "+d.selectedUserID)},void(d.confirmResetPWD=function(){console.log("Confirmed to reset member name: "+d.selectedUserItem.memberName),e.get(a+"eden/membs/pc/"+d.selectedUserItem.memberMobile).then(function(a){200===a.status?(console.log("Reset password for user item successfully."),$(reset).modal("hide")):console.log("Failed to reset password for user item, status code: "+a.status)},function(a){console.log("Failed to reset password for user item")})}))}),d.controller("logDownloadCtrl",function(d,e,f){if(b())return window.location.href="#login/",void f.setForwardURL("#log_download");f.setForwardURL(null),d.logItems=null,d.allItemsLength=0,d.currentPage=0,d.pageInTotal=0,d.previousInvalid=!0,d.nextInvalid=!0,d.pageNumType=["5","10","20","50"],c(),d.itemNumOfPage="10",console.log("Invoke log list controller, get download log list"),e.get(a+"eden/logs/lists").then(function(a){d.logAllItems=a.data,d.allItemsLength=d.logAllItems.length,d.allItemsLength>0?d.changeNumOfPage():d.logItems=[]},function(a){console.log("Failed to get log list")});var g=function(){d.pageInTotal=(d.allItemsLength/d.itemNumOfPage).toFixed(),d.allItemsLength>d.itemNumOfPage*d.pageInTotal&&d.pageInTotal++,d.previousInvalid=!0,d.pageInTotal>d.currentPage?d.nextInvalid=!1:d.nextInvalid=!0,d.currentPage>1?d.previousInvalid=!1:d.previousInvalid=!0;var a=(d.currentPage-1)*d.itemNumOfPage;d.logItems=d.logAllItems.slice(a,a+d.itemNumOfPage)};d.changeNumOfPage=function(){console.log("Change number of page to "+d.itemNumOfPage),d.allItemsLength>0&&(d.currentPage=1,g())},d.previousPage=function(){console.log("Click previous button"),d.currentPage--,g()},d.nextPage=function(){console.log("Click next button"),d.currentPage++,g()}}),d.controller("systemInfoCtrl",function(c,d,e){if(b())return window.location.href="#login/",void e.setForwardURL("#system_info");e.setForwardURL(null),c.systemInfo={},c.systemInfo.systemLatestVersion="",c.systemInfo.systemApkDownUrl="",d.get(a+"eden/sys/version").then(function(a){console.log("Success to get system info"),c.systemInfo.systemLatestVersion=a.data.systemLatestVersion,c.systemInfo.systemApkDownUrl=a.data.systemApkDownUrl},function(a){console.log("Failed to get system info")});var f=function(b){console.log("Selected file number: "+b.length);var e=new FormData;e.append("root",b[0]),d.post(a+"eden/prods/upload",e,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload APK file successfully"),c.systemInfo.systemApkDownUrl=a.data.urls):console.log("Failed to upload APK file")},function(a){console.log("Failed to upload APK file")})};c.updateAPKFile=function(){f(c.apkFile)},c.updateAPKFileStart=function(){$("#apkFileSelect").click(),console.log("Click APK file selection dialog")},c.systemInfoSubmit=function(){d.post(a+"eden/sys/save",c.systemInfo).then(function(a){200==a.status&&(alert("更新系统信息成功！"),console.log("Update/create system info successfully."))},function(a){console.log("Failed to update/create system info ")})}}),d.controller("loginCtrl",function(b,c,d){b.loginInvalid=!1,b.userLogin=function(){c.get(a+"eden/membs/pc/login/"+b.userName+"/"+b.userPassword).then(function(a){200==a.status&&"successful"==a.data.msg?(console.log("Login successful"),sessionStorage.setItem("userName",b.userName),sessionStorage.setItem("timeStamp",new Date),window.location.href=null==d.getForwardURL()?"#primary_product":d.getForwardURL()):(console.log("Failed to login"),b.loginInvalid=!0)},function(a){console.log("Failed to login"),b.loginInvalid=!0})}}),d.controller("logoutCtrl",function(a,b){sessionStorage.removeItem("userName"),sessionStorage.removeItem("timeStamp"),window.location.href="#login/"}),d.controller("otherUrlCtrl",function(a){return console.log("Otherwise URL contoller..."),b()?(window.location.href="#login/",void a.setForwardURL("#primary_product")):void a.setForwardURL(null)})}());