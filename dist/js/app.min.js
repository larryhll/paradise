/*! 
* FUNP - v1.0.0 
* © Copyright 2016  Liangli Huang
 */
$(function(){var a="http://118.178.124.197:8080/",b=function(){var a=$("#loadingScreen"),b=a.width();a.css("margin-left",b>441?(b-441)/2:"0px"),$(window).resize(function(){var a=$("#loadingScreen"),b=a.width();a.css("margin-left",b>441?(b-441)/2:"0px")})},c=angular.module("app",["ngRoute"]);c.service("productBackAction",function(){var a=!1,b=null,c=null,d=null,e=null;return{getProductBack:function(){return a},getType:function(){return b},getPublishState:function(){return c},getProductRecommend:function(){return d},getProductCategory:function(){return e},setProductBack:function(b){a=b},setType:function(a){b=a},setPublishState:function(a){c=a},setProductRecommend:function(a){d=a},setProductCategory:function(a){e=a}}}),c.directive("fileInput",["$parse",function(a){return{restrict:"A",link:function(b,c,d){c.bind("change",function(){a(d.fileInput).assign(b,c[0].files),b.$apply(),angular.element(this)[0].nextElementSibling.click()})}}}]),c.config(function(a){a.when("/primary_product",{templateUrl:"app/views/product/primary_product.html",controller:"primaryProductCtrl"}).when("/product_list",{templateUrl:"app/views/product/product_list.html",controller:"productListCtrl"}).when("/new_ar_product_detail/:productID",{templateUrl:"app/views/product/new_ar_product_detail.html",controller:"updateARProductDetail"}).when("/new_ar_product_detail",{templateUrl:"app/views/product/new_ar_product_detail.html",controller:"newARDetailCtrl"}).when("/new_video_product_detail/:productID",{templateUrl:"app/views/product/new_video_product_detail.html",controller:"updateVideoDetailCtrl"}).when("/new_video_product_detail",{templateUrl:"app/views/product/new_video_product_detail.html",controller:"newVideoDetailCtrl"}).when("/first_level_category",{templateUrl:"app/views/category/first_level_category.html",controller:"firstLevelCategoryCtrl"}).when("/second_level_category",{templateUrl:"app/views/category/second_level_category.html",controller:"secondLevelCategoryCtrl"}).when("/user_admin",{templateUrl:"app/views/user/user_admin.html",controller:"userAdminCtrl"}).when("/log_download",{templateUrl:"app/views/log/log_download.html",controller:"logDownloadCtrl"}).otherwise("/primary_product",{templateUrl:"app/views/product/primary_product.html",controller:"otherUrlCtrl"})}),c.controller("primaryProductCtrl",function(b,c){b.productItems=[],b.layoutUpdate={entities:[]},c.get(a+"eden/prods/allprods").then(function(d){console.log("Get all product list successfully."),b.productItems=d.data,c.get(a+"eden/membs/unlogin").then(function(a){console.log("Get product layout"),angular.forEach(a.data.layoutDOs,function(a){var c={};c.layoutPosition=a.layoutPosition,c.layoutValue=a.layoutValue,b.layoutUpdate.entities.push(c),angular.forEach(b.productItems,function(c){null!==a.layoutValue&&c.id===a.layoutValue&&(1==a.layoutPosition?(b.mainProductOne=c,null!==b.mainProductOne.productCover&&"undefined"!=typeof b.mainProductOne.productCover&&$("#mainProductOneImage").attr("src",b.mainProductOne.productCover)):2==a.layoutPosition?(b.mainProductTwo=c,null!==b.mainProductTwo.productCover&&"undefined"!=typeof b.mainProductTwo.productCover&&$("#mainProductTwoImage").attr("src",b.mainProductTwo.productCover)):3==a.layoutPosition?(b.mainProductThree=c,null!==b.mainProductThree.productCover&&"undefined"!=typeof b.mainProductThree.productCover&&$("#mainProductThreeImage").attr("src",b.mainProductThree.productCover)):4==a.layoutPosition&&(b.mainProductFour=c,null!==b.mainProductFour.productCover&&"undefined"!=typeof b.mainProductFour.productCover&&$("#mainProductFourImage").attr("src",b.mainProductFour.productCover)))})}),0==b.layoutUpdate.entities.length&&(b.layoutUpdate={entities:[{layoutPosition:1,layoutValue:null},{layoutPosition:2,layoutValue:null},{layoutPosition:3,layoutValue:null},{layoutPosition:4,layoutValue:null}]})},function(a){console.log("Failed to get product layout")})},function(a){console.log("Failed to get product list by filter")}),b.mainProductOneChange=function(){var a=0;angular.forEach(b.layoutUpdate.entities,function(c){1==c.layoutPosition&&(b.layoutUpdate.entities[a].layoutValue=b.mainProductOne.id,$("#mainProductOneImage").attr("src",b.mainProductOne.productCover)),a++})},b.mainProductTwoChange=function(){var a=0;angular.forEach(b.layoutUpdate.entities,function(c){2==c.layoutPosition&&(b.layoutUpdate.entities[a].layoutValue=b.mainProductTwo.id,$("#mainProductTwoImage").attr("src",b.mainProductTwo.productCover)),a++})},b.mainProductThreeChange=function(){var a=0;angular.forEach(b.layoutUpdate.entities,function(c){3==c.layoutPosition&&(b.layoutUpdate.entities[a].layoutValue=b.mainProductThree.id,$("#mainProductThreeImage").attr("src",b.mainProductThree.productCover)),a++})},b.mainProductFourChange=function(){var a=0;angular.forEach(b.layoutUpdate.entities,function(c){4==c.layoutPosition&&(b.layoutUpdate.entities[a].layoutValue=b.mainProductFour.id,$("#mainProductFourImage").attr("src",b.mainProductFour.productCover)),a++})},b.saveLayout=function(){c.post(a+"eden/layout/updates",b.layoutUpdate).then(function(a){200==a.status?console.log("Update product layout successfully"):console.log("Failed to update product layout"),$("#updateLayoutModal").modal("hide")},function(a){console.log("Failed to update product layout"),$("#updateLayoutModal").modal("hide")})}}),c.controller("productListCtrl",function(c,d,e){c.productItems=null,c.productItems_selected=[],c.actionSelected="",c.productItems_copy=[],b(),c.productCategoryList=["全部"],c.productCategory=c.productCategoryList[0],d.get(a+"eden/cates/list/leveltwo").then(function(a){console.log("Get all level two category list successfully");for(var b in a.data)c.productCategoryList.push(a.data[b].categoryName)},function(a){console.log("Failed to get level two category list")}),c.publishState="上架",c.productType="视频产品",c.recommendation="是",c.searchProductListByFilters=function(){console.log("Starting to search product items by filters..."),console.log("Selected product category: "+c.productCategory+" Selected index: "+$("#product_category").prop("selectedIndex")),console.log("Selected product type: "+c.productType+" Selected index: "+$("#product_type").prop("selectedIndex")),console.log("Selected publish state: "+c.publishState+" Selected index: "+$("#publish_state").prop("selectedIndex")),console.log("Selected recommendation: "+c.recommendation+" Selected index: "+$("#recommendation").prop("selectedIndex"));var b={};e.getProductBack()?(b.type=e.getType(),b.publishState=e.getPublishState(),b.productRecommend=e.getProductRecommend(),b.productCategory=e.getProductCategory(),c.productCategory=e.getProductCategory(),c.publishState=0==e.getPublishState()?"上架":"下架",c.productType=0==e.getType()?"视频产品":"AR产品",c.recommendation=0==e.getProductRecommend()?"是":"否"):(b.type=$("#product_type").prop("selectedIndex"),b.publishState=$("#publish_state").prop("selectedIndex"),b.productRecommend=$("#recommendation").prop("selectedIndex"),b.productCategory=c.productCategory),e.setProductBack(!1),d.post(a+"eden/prods/lists",b).then(function(a){console.log("Get product list by filter successfully."),c.productItems=a.data,c.productItems_copy=a.data,c.productItems_selected=[]},function(a){console.log("Failed to get product list by filter")})},c.searchProductListByFilters(),c.cleanSearchProductListByFilters=function(){d.get(a+"eden/prods/allprods").then(function(a){console.log("Get all product list successfully."),c.productItems=a.data,c.productItems_copy=a.data,c.productItems_selected=[]},function(a){console.log("Failed to get all product list")})},c.checkALLYesNo=function(){console.log("Check all flag: "+c.checkAll);var a=$("input[name=mySelectedProduct]");if(a.prop("checked",c.checkAll),c.productItems_selected=[],c.checkAll)for(var b in c.productItems_copy)c.productItems_selected.push(c.productItems_copy[b]);console.log("Current selected number: "+c.productItems_selected.length)},c.checkItem=function(a){if(console.log("Check item flag: "+a.checked),a.checked)c.productItems_selected.push(a);else for(var b in c.productItems_selected)c.productItems_selected[b].id==a.id&&c.productItems_selected.splice(b,1);console.log("Current selected number: "+c.productItems_selected.length);var d=$("#allCheckControl");0==c.productItems_selected.length?d.prop("checked",!1):c.productItems_selected.length==c.productItems_copy.length&&d.prop("checked",!0)},c.actionClickModal=function(a){console.log("Click button: "+a),c.actionSelected=a},c.actionConfirm=function(){console.log("Confirm action: "+c.actionSelected),angular.forEach(c.productItems_selected,function(b){d.get(a+"eden/prods/opes/"+c.actionSelected+"/"+b.id).then(function(a){console.log(c.actionSelected+" product: "+b.name+" successfully"),$(confirmDiag).modal("hide");var d=$("#allCheckControl");d.prop("checked",!1),c.searchProductListByFilters()},function(a){console.log("Failed to "+c.actionSelected+" product: "+b.name)})})}}),c.controller("updateARProductDetail",function(b,c,d,e){console.log("Product ID: "+d.productID),b.firstScreenShot="",b.secondScreenShot="",b.thirdScreenShot="";var f=function(){c.get(a+"eden/prods/"+d.productID).then(function(a){console.log("Success to get AR product item: "+d.productID),b.productInfo=a.data;var c=a.data.productImages.split(",");b.firstScreenShot="undefined"==typeof c[0]?"":c[0],b.secondScreenShot="undefined"==typeof c[1]?"":c[1],b.thirdScreenShot="undefined"==typeof c[2]?"":c[2];var e=a.data.media.split(",");e.indexOf("电子书")>=0?b.mediaTypeElectricBook=!0:b.mediaTypeElectricBook=!1,e.indexOf("书籍")>=0?b.mediaTypeBook=!0:b.mediaTypeBook=!1,e.indexOf("卡牌")>=0?b.mediaTypeCard=!0:b.mediaTypeCard=!1,e.indexOf("教具")>=0?b.mediaTypeTeachTool=!0:b.mediaTypeTeachTool=!1,e.indexOf("益智玩具")>=0?b.mediaTypeIntelligentToy=!0:b.mediaTypeIntelligentToy=!1,e.indexOf("其它")>=0?b.mediaTypeOther=!0:b.mediaTypeOther=!1,b.productInfo.productAppEnabled=0==b.productInfo.productAppEnabled,b.productInfo.productPlayEnabled=0==b.productInfo.productPlayEnabled,b.productInfo.productTrialEnabled=0==b.productInfo.productTrialEnabled,$("#productMatchAgeScope").prop("selectedIndex",b.productInfo.productMatchScope),angular.forEach(b.levelTwoCategoryItems,function(a){a.categoryName==b.productInfo.productCategory&&(b.levelTwoCategory=a)})},function(a){console.log("Failed to get AR product item")})},g=function(){c.get(a+"eden/cates/list/leveltwo").then(function(a){b.levelTwoCategory={},b.levelTwoCategoryItems=a.data,a.data.length>0&&(b.levelTwoCategory=a.data[0],console.log("Success to get all the second level category")),f()},function(a){console.log("Failed to get all the second level category")})};g();var h=function(d,e,f){console.log("Selected file number: "+d.length);var g=new FormData;g.append("root",d[0]),c.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?b.productInfo.productDesc=a.data.urls:"cover"==f?b.productInfo.productCover=a.data.urls:"firstScreen"==f?b.firstScreenShot=a.data.urls:"secondScreen"==f?b.secondScreenShot=a.data.urls:"thirdScreen"==f?b.thirdScreenShot=a.data.urls:"trial"==f?b.productInfo.productTrialAddr=a.data.urls:"QRCode"==f&&(b.productInfo.productMicroStoreByecodeAddr=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};b.updateProductDescriptionImage=function(){h(b.productDescriptionImageFile,"productDescImage","description")},b.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},b.updateProductCoverImage=function(){h(b.productCoverImageFile,"productCoverImage","cover")},b.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},b.updateFirstScreenShotImage=function(){h(b.firstScreenShotFile,"productScreenShotFirstImage","firstScreen")},b.updateFirstScreenShotImageStart=function(){$("#productScreenShotFirstFileSelect").click(),console.log("Click the first product screen shot file selection dialog")},b.updateSecondScreenShotImage=function(){h(b.secondScreenShotFile,"productScreenShotSecondImage","secondScreen")},b.updateSecondScreenShotImageStart=function(){$("#productScreenShotSecondFileSelect").click(),console.log("Click the second product screen shot file selection dialog")},b.updateThirdScreenShotImage=function(){h(b.thirdScreenShotFile,"productScreenShotThirdImage","thirdScreen")},b.updateThirdScreenShotImageStart=function(){$("#productScreenShotThirdFileSelect").click(),console.log("Click the third product screen shot file selection dialog")},b.updateProductTrialImage=function(){h(b.productTrialFile,"productTrialImage","trial")},b.updateProductTrialImageStart=function(){$("#productTrialFileSelect").click(),console.log("Click product trial file selection dialog")},b.updateProductQRImage=function(){h(b.productQRFile,"productQRImage","QRCode")},b.updateProductQRImageStart=function(){$("#productQRFileSelect").click(),console.log("Click product QR code image file selection dialog")};var i=function(d){console.log("Selected file number: "+d.length);var e=new FormData;e.append("root",d[0]),c.post(a+"eden/prods/upload",e,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload APK file successfully"),b.productInfo.productApkDownUrl=a.data.urls):console.log("Failed to upload APK file")},function(a){console.log("Failed to upload APK file")})};b.updateAPKFile=function(){i(b.apkFile)},b.updateAPKFileStart=function(){$("#apkFileSelect").click(),console.log("Click APK file selection dialog")},b.submitProductInfo=function(){b.productInfo.productCategory=b.levelTwoCategory.categoryName,b.productInfo.productCategoryId=b.levelTwoCategory.id,b.productInfo.productLevelTwo=b.levelTwoCategory.categoryName;var d=[];d.push(b.mediaTypeElectricBook?"电子书":""),d.push(b.mediaTypeBook?"书籍":""),d.push(b.mediaTypeCard?"卡牌":""),d.push(b.mediaTypeTeachTool?"教具":""),d.push(b.mediaTypeIntelligentToy?"益智玩具":""),d.push(b.mediaTypeOther?"其它":""),b.productInfo.media=d.map(function(a){if(""!=a)return a}).join(","),b.productInfo.productMatchScope=$("#productMatchAgeScope").prop("selectedIndex");var f=[];""!==b.firstScreenShot&&f.push(b.firstScreenShot),""!==b.secondScreenShot&&f.push(b.secondScreenShot),""!==b.thirdScreenShot&&f.push(b.thirdScreenShot),b.productInfo.productImages=f.map(function(a){return a}).join(","),b.productInfo.productUploadDate=new Date,b.productInfo.productModifyDate=new Date,b.productInfo.productAppEnabled=b.productInfo.productAppEnabled?0:1,b.productInfo.productPlayEnabled=b.productInfo.productPlayEnabled?0:1,b.productInfo.productTrialEnabled=b.productInfo.productTrialEnabled?0:1,c.post(a+"eden/prods/update",b.productInfo).then(function(a){200===a.status?(console.log("Update AR product item successfully"),e.setProductBack(!0),e.setType(b.productInfo.type),e.setPublishState(b.productInfo.publishState),e.setProductRecommend(b.productInfo.productRecommend),e.setProductCategory(b.productInfo.productCategory),window.location.href="#product_list/"):console.log("Failed to update AR product item ")},function(a){console.log("Failed to update AR product item ")})}}),c.controller("newARDetailCtrl",function(b,c,d){b.productInfo={},b.firstScreenShot="",b.secondScreenShot="",b.thirdScreenShot="",c.get(a+"eden/cates/list/leveltwo").then(function(a){b.levelTwoCategory={},b.levelTwoCategoryItems=a.data,a.data.length>0&&(b.levelTwoCategory=a.data[0],console.log("Success to get all the second level category"))},function(a){console.log("Failed to get all the second level category")});var e=function(d,e,f){console.log("Selected file number: "+d.length);var g=new FormData;g.append("root",d[0]),c.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?b.productInfo.productDesc=a.data.urls:"cover"==f?b.productInfo.productCover=a.data.urls:"firstScreen"==f?b.firstScreenShot=a.data.urls:"secondScreen"==f?b.secondScreenShot=a.data.urls:"thirdScreen"==f?b.thirdScreenShot=a.data.urls:"trial"==f?b.productInfo.productTrialAddr=a.data.urls:"QRCode"==f&&(b.productInfo.productMicroStoreByecodeAddr=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};b.updateProductDescriptionImage=function(){e(b.productDescriptionImageFile,"productDescImage","description")},b.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},b.updateProductCoverImage=function(){e(b.productCoverImageFile,"productCoverImage","cover")},b.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},b.updateFirstScreenShotImage=function(){e(b.firstScreenShotFile,"productScreenShotFirstImage","firstScreen")},b.updateFirstScreenShotImageStart=function(){$("#productScreenShotFirstFileSelect").click(),console.log("Click the first product screen shot file selection dialog")},b.updateSecondScreenShotImage=function(){e(b.secondScreenShotFile,"productScreenShotSecondImage","secondScreen")},b.updateSecondScreenShotImageStart=function(){$("#productScreenShotSecondFileSelect").click(),console.log("Click the second product screen shot file selection dialog")},b.updateThirdScreenShotImage=function(){e(b.thirdScreenShotFile,"productScreenShotThirdImage","thirdScreen")},b.updateThirdScreenShotImageStart=function(){$("#productScreenShotThirdFileSelect").click(),console.log("Click the third product screen shot file selection dialog")},b.updateProductTrialImage=function(){e(b.productTrialFile,"productTrialImage","trial")},b.updateProductTrialImageStart=function(){$("#productTrialFileSelect").click(),console.log("Click product trial file selection dialog")},b.updateProductQRImage=function(){e(b.productQRFile,"productQRImage","QRCode")},b.updateProductQRImageStart=function(){$("#productQRFileSelect").click(),console.log("Click product QR code image file selection dialog")};var f=function(d){console.log("Selected file number: "+d.length);var e=new FormData;e.append("root",d[0]),c.post(a+"eden/prods/upload",e,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload APK file successfully"),b.productInfo.productApkDownUrl=a.data.urls):console.log("Failed to upload APK file")},function(a){console.log("Failed to upload APK file")})};b.updateAPKFile=function(){f(b.apkFile)},b.updateAPKFileStart=function(){$("#apkFileSelect").click(),console.log("Click APK file selection dialog")},b.submitProductInfo=function(){b.productInfo.type=1,b.productInfo.publishState=1,b.productInfo.productRecommend=1,b.productInfo.productCategory=b.levelTwoCategory.categoryName,b.productInfo.productCategoryId=b.levelTwoCategory.id,b.productInfo.productLevelTwo=b.levelTwoCategory.categoryName;var e=[];e.push(b.mediaTypeElectricBook?"电子书":""),e.push(b.mediaTypeBook?"书籍":""),e.push(b.mediaTypeCard?"卡牌":""),e.push(b.mediaTypeTeachTool?"教具":""),e.push(b.mediaTypeIntelligentToy?"益智玩具":""),e.push(b.mediaTypeOther?"其它":""),b.productInfo.media=e.map(function(a){if(""!=a)return a}).join(","),b.productInfo.productMatchScope=$("#productMatchAgeScope").prop("selectedIndex"),b.productInfo.productImages="";var f=[];""!==b.firstScreenShot&&f.push(b.firstScreenShot),""!==b.secondScreenShot&&f.push(b.secondScreenShot),""!==b.thirdScreenShot&&f.push(b.thirdScreenShot),b.productInfo.productImages=f.map(function(a){return a}).join(","),b.productInfo.productUploadDate=new Date,b.productInfo.productModifyDate=new Date,b.productInfo.productAppEnabled=b.productInfo.productAppEnabled?0:1,b.productInfo.productPlayEnabled=b.productInfo.productPlayEnabled?0:1,b.productInfo.productTrialEnabled=b.productInfo.productTrialEnabled?0:1,c.post(a+"eden/prods/add",b.productInfo).then(function(a){200===a.status?(console.log("Create AR product item successfully"),d.setProductBack(!0),d.setType(b.productInfo.type),d.setPublishState(b.productInfo.publishState),d.setProductRecommend(b.productInfo.productRecommend),d.setProductCategory(b.productInfo.productCategory),window.location.href="#product_list/"):console.log("Failed to create AR product item ")},function(a){console.log("Failed to create AR product item ")})}}),c.controller("updateVideoDetailCtrl",function(b,c,d,e){var f=function(){c.get(a+"eden/prods/"+d.productID).then(function(a){b.productInfo=a.data;var c=a.data.media.split(",");c.indexOf("电子书")>=0?b.mediaTypeElectricBook=!0:b.mediaTypeElectricBook=!1,c.indexOf("书籍")>=0?b.mediaTypeBook=!0:b.mediaTypeBook=!1,c.indexOf("卡牌")>=0?b.mediaTypeCard=!0:b.mediaTypeCard=!1,c.indexOf("教具")>=0?b.mediaTypeTeachTool=!0:b.mediaTypeTeachTool=!1,c.indexOf("益智玩具")>=0?b.mediaTypeIntelligentToy=!0:b.mediaTypeIntelligentToy=!1,c.indexOf("其它")>=0?b.mediaTypeOther=!0:b.mediaTypeOther=!1,$("#productMatchAgeScope").prop("selectedIndex",b.productInfo.productMatchScope),angular.forEach(b.levelTwoCategoryItems,function(a){a.categoryName==b.productInfo.productCategory&&(b.levelTwoCategory=a)})},function(a){console.log("Failed to get AR product item")})},g=function(){c.get(a+"eden/cates/list/leveltwo").then(function(a){b.levelTwoCategory={},b.levelTwoCategoryItems=a.data,a.data.length>0&&(b.levelTwoCategory=a.data[0],console.log("Success to get all the second level category")),f()},function(a){console.log("Failed to get all the second level category")})};g();var h=function(d,e,f){console.log("Selected file number: "+d.length);var g=new FormData;g.append("root",d[0]),c.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?b.productInfo.productDesc=a.data.urls:"cover"==f&&(b.productInfo.productCover=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};b.updateProductDescriptionImage=function(){h(b.productDescriptionImageFile,"productDescImage","description")},b.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},b.updateProductCoverImage=function(){h(b.productCoverImageFile,"productCoverImage","cover")},b.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},b.selectVideoItem=function(a){b.videoItemSelected=a},b.delVideoItem=function(){for(var a in b.productInfo.videoDOs){var c=b.productInfo.videoDOs.indexOf(b.videoItemSelected);c>-1&&(b.productInfo.videoDOs.splice(c,1),console.log("Delete video item index: "+c))}$(deleteVideoItemModal).modal("hide")},b.newVideoItem=function(){var a={};a.videoName=b.videoName,a.videoUrl=b.videoUrl,b.productInfo.videoDOs.push(a),$(newVideoItemModal).modal("hide")},b.submitProductInfo=function(){b.productInfo.productModifyDate=new Date,b.productInfo.productCategory=b.levelTwoCategory.categoryName,b.productInfo.productCategoryId=b.levelTwoCategory.id,b.productInfo.productLevelTwo=b.levelTwoCategory.categoryName;var d=[];d.push(b.mediaTypeElectricBook?"电子书":""),d.push(b.mediaTypeBook?"书籍":""),d.push(b.mediaTypeCard?"卡牌":""),d.push(b.mediaTypeTeachTool?"教具":""),d.push(b.mediaTypeIntelligentToy?"益智玩具":""),d.push(b.mediaTypeOther?"其它":""),b.productInfo.media=d.map(function(a){if(""!=a)return a}).join(","),b.productInfo.productMatchScope=$("#productMatchAgeScope").prop("selectedIndex"),c.post(a+"eden/prods/update",b.productInfo).then(function(a){200===a.status?(console.log("Update video product item successfully, go back to product list page..."),e.setProductBack(!0),e.setType(b.productInfo.type),e.setPublishState(b.productInfo.publishState),e.setProductRecommend(b.productInfo.productRecommend),e.setProductCategory(b.productInfo.productCategory),window.location.href="#product_list/"):console.log("Failed to update video product item")},function(a){console.log("Failed to update video product item ")})}}),c.controller("newVideoDetailCtrl",function(b,c,d){b.productInfo={},b.productInfo.videoDOs=[],c.get(a+"eden/cates/list/leveltwo").then(function(a){b.levelTwoCategory={},b.levelTwoCategoryItems=a.data,a.data.length>0&&(b.levelTwoCategory=a.data[0],console.log("Success to get all the second level category"))},function(a){console.log("Failed to get all the second level category")});var e=function(d,e,f){console.log("Selected file number: "+d.length);var g=new FormData;g.append("root",d[0]),c.post(a+"eden/prods/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"}}).then(function(a){200===a.status?(console.log("Upload image file successfully"),$("#"+e).attr("src",a.data.urls),"description"==f?b.productInfo.productDesc=a.data.urls:"cover"==f&&(b.productInfo.productCover=a.data.urls)):console.log("Failed to upload image file")},function(a){console.log("Failed to upload image file")})};b.updateProductDescriptionImage=function(){e(b.productDescriptionImageFile,"productDescImage","description")},b.updateProductDescriptionImageStart=function(){$(productDescFileSelect).click(),console.log("Click product description file selection dialog")},b.updateProductCoverImage=function(){e(b.productCoverImageFile,"productCoverImage","cover")},b.updateProductCoverImageStart=function(){$(productCoverFileSelect).click(),console.log("Click product cover file selection dialog")},b.selectVideoItem=function(a){b.videoItemSelected=a},b.delVideoItem=function(){for(var a in b.productInfo.videoDOs){var c=b.productInfo.videoDOs.indexOf(b.videoItemSelected);c>-1&&(b.productInfo.videoDOs.splice(c,1),console.log("Delete video item index: "+c))}$(deleteVideoItemModal).modal("hide")},b.newVideoItem=function(){var a={};a.videoName=b.videoName,a.videoUrl=b.videoUrl,b.productInfo.videoDOs.push(a),$(newVideoItemModal).modal("hide")},b.submitProductInfo=function(){b.productInfo.type=0,b.productInfo.publishState=1,b.productInfo.productRecommend=1,b.productInfo.productCategory=b.levelTwoCategory.categoryName,b.productInfo.productCategoryId=b.levelTwoCategory.id,b.productInfo.productLevelTwo=b.levelTwoCategory.categoryName;var e=[];e.push(b.mediaTypeElectricBook?"电子书":""),e.push(b.mediaTypeBook?"书籍":""),e.push(b.mediaTypeCard?"卡牌":""),e.push(b.mediaTypeTeachTool?"教具":""),e.push(b.mediaTypeIntelligentToy?"益智玩具":""),e.push(b.mediaTypeOther?"其它":""),b.productInfo.media=e.map(function(a){if(""!=a)return a}).join(","),b.productInfo.productMatchScope=$("#productMatchAgeScope").prop("selectedIndex"),b.productInfo.productUploadDate=new Date,b.productInfo.productModifyDate=new Date,c.post(a+"eden/prods/add",b.productInfo).then(function(a){200===a.status?(console.log("Create video product item successfully"),d.setProductBack(!0),d.setType(b.productInfo.type),d.setPublishState(b.productInfo.publishState),d.setProductRecommend(b.productInfo.productRecommend),d.setProductCategory(b.productInfo.productCategory),window.location.href="#product_list/"):console.log("Failed to create video product item ")},function(a){console.log("Failed to create video product item ")})}}),c.controller("firstLevelCategoryCtrl",function(c,d){c.firstLevelCategoryItems=null,b(),firstLevelCategoryItems_temp=[],d.get(a+"eden/cates/list/levelone").then(function(a){c.firstLevelCategoryItems=a.data,firstLevelCategoryItems_temp=c.firstLevelCategoryItems},function(a){console.log("Failed to get the first level category")}),c.searchByCategory=function(){if(null===c.firstLevelCategoryItems)return void console.log("The first level category is empty");c.firstLevelCategoryItems=[];var a=new RegExp(c.firstCategorySearch,"i");for(var b in firstLevelCategoryItems_temp)a.test(firstLevelCategoryItems_temp[b].categoryName)&&c.firstLevelCategoryItems.push(firstLevelCategoryItems_temp[b])},c.updateItem=function(a){c.currentUpdateItem=a,c.levelOneCategoryName=a.categoryName},c.updateFirstCategory=function(){console.log("Update the first level category: "+c.levelOneCategoryName),c.currentUpdateItem.categoryName=c.levelOneCategoryName,d.post(a+"eden/cates/update",c.currentUpdateItem).then(function(b){console.log("Update first category item successfully."),$(updateFirstCategoryModal).modal("hide"),d.get(a+"eden/cates/list/levelone").then(function(a){c.firstLevelCategoryItems=a.data},function(a){console.log("Failed to get the first level category")})},function(a){console.log("Failed to update first category item ")})},c.createFirstCategory=function(){var b={};b.categoryName=c.newFirstCategoryName,b.categoryUpdateDate=new Date,b.categoryLevel=1,b.categoryPrevious=0,b.categoryDeleted=0,d.post(a+"eden/cates/add",b).then(function(b){console.log("Create first category item successfully."),$(newFirstCategoryModal).modal("hide"),d.get(a+"eden/cates/list/levelone").then(function(a){c.firstLevelCategoryItems=a.data},function(a){console.log("Failed to get the first level category")})},function(a){console.log("Failed to create first category item ")}),c.newFirstCategoryName=""}}),c.controller("secondLevelCategoryCtrl",function(c,d){c.levelTwoCategoryItems=null,c.levelOneCategoryItems=null,b(),d.get(a+"eden/cates/list/levelone").then(function(b){c.levelOneCategoryItems=b.data,b.data.length>0&&(c.levelOneCategorySelected=b.data[0],c.levelOneCategoryForLevelTwoCreation=b.data[0],d.get(a+"eden/cates/list/leveltwo/"+c.levelOneCategorySelected.id).then(function(a){c.levelTwoCategoryItems=a.data,levelTwoCategoryItems_temp=c.levelTwoCategoryItems,console.log("Success to get the second level category")},function(a){console.log("Failed to get the second level category")}))},function(a){console.log("Failed to get the first level category")}),levelTwoCategoryItems_temp=[],c.changeLevelOneCategory=function(){d.get(a+"eden/cates/list/leveltwo/"+c.levelOneCategorySelected.id).then(function(a){c.levelTwoCategoryItems=a.data,levelTwoCategoryItems_temp=c.levelTwoCategoryItems,console.log("Success to get the second level category")},function(a){console.log("Failed to get the second level category")})},c.searchByCategory=function(){c.levelTwoCategoryItems=[],"undefined"==typeof c.levelTwoCategoryFilter&&(c.levelTwoCategoryFilter="");var a=new RegExp(c.levelTwoCategoryFilter,"i");for(var b in levelTwoCategoryItems_temp)a.test(levelTwoCategoryItems_temp[b].categoryName)&&c.levelTwoCategoryItems.push(levelTwoCategoryItems_temp[b])},c.updateItem=function(a){c.updatedLevelTwoItem=a,c.levelTwoCategoryUpdated=a.categoryName},c.updateLevelTwoCategory=function(){console.log("Update the second level category: "+c.levelTwoCategoryUpdated),c.updatedLevelTwoItem.categoryName=c.levelTwoCategoryUpdated,d.post(a+"eden/cates/update",c.updatedLevelTwoItem).then(function(b){console.log("Update level two category item successfully."),$(updateSecondCategoryModal).modal("hide"),d.get(a+"eden/cates/list/leveltwo/"+c.levelOneCategorySelected.id).then(function(a){c.levelTwoCategoryItems=a.data,levelTwoCategoryItems_temp=c.levelTwoCategoryItems,console.log("Success to get the second level category")},function(a){console.log("Failed to get the second level category")})},function(a){console.log("Failed to update level two category item ")})},c.createLevelTwoCategory=function(){var b={};b.categoryName=c.levelTwoCategoryForLevelTwoCreation,b.categoryLevel=2,b.categoryUpdateDate=new Date,b.categoryPrevious=c.levelOneCategoryForLevelTwoCreation.id,b.categoryDeleted=0,d.post(a+"eden/cates/add",b).then(function(b){console.log("Create level two category item successfully."),$(newLevelTwoCategoryModal).modal("hide"),d.get(a+"eden/cates/list/leveltwo/"+c.levelOneCategorySelected.id).then(function(a){
c.levelTwoCategoryItems=a.data,levelTwoCategoryItems_temp=c.levelTwoCategoryItems,console.log("Success to get the second level category")},function(a){console.log("Failed to get the second level category")})},function(a){console.log("Failed to create level two category item ")})}}),c.controller("userAdminCtrl",function(c,d){c.userItems=null,b(),console.log("Invoke user admin controller, get user admin list data"),d.get(a+"eden/membs/lists").then(function(a){c.userItems=a.data,userItems_temp=a.data},function(a){console.log("Failed to get admin user list")}),c.searchUserListByPhone=function(){c.userItems=[];var a=new RegExp(c.searchPhoneNumber,"i");for(var b in userItems_temp)a.test(userItems_temp[b].memberMobile)&&c.userItems.push(userItems_temp[b])},c.resetPWD=function(a){c.selectedUserID=a.id,c.selectedUserItem=a,console.log("Selected user id: "+c.selectedUserID)},c.confirmResetPWD=function(){console.log("Confirmed to reset member name: "+c.selectedUserItem.memberName),d.get(a+"eden/membs/pc/"+c.selectedUserItem.memberMobile).then(function(a){200===a.status?(console.log("Reset password for user item successfully."),$(reset).modal("hide")):console.log("Failed to reset password for user item, status code: "+a.status)},function(a){console.log("Failed to reset password for user item")})}}),c.controller("logDownloadCtrl",function(c,d){c.logItems=null,c.allItemsLength=0,c.currentPage=0,c.pageInTotal=0,c.previousInvalid=!0,c.nextInvalid=!0,c.pageNumType=["5","10","20","50"],b(),c.itemNumOfPage="10",console.log("Invoke log list controller, get download log list"),d.get(a+"eden/logs/lists").then(function(a){c.logAllItems=a.data,c.allItemsLength=c.logAllItems.length,c.allItemsLength>0?c.changeNumOfPage():c.logItems=[]},function(a){console.log("Failed to get log list")});var e=function(){c.pageInTotal=(c.allItemsLength/c.itemNumOfPage).toFixed(),c.allItemsLength>c.itemNumOfPage*c.pageInTotal&&c.pageInTotal++,c.previousInvalid=!0,c.pageInTotal>c.currentPage?c.nextInvalid=!1:c.nextInvalid=!0,c.currentPage>1?c.previousInvalid=!1:c.previousInvalid=!0;var a=(c.currentPage-1)*c.itemNumOfPage;c.logItems=c.logAllItems.slice(a,a+c.itemNumOfPage)};c.changeNumOfPage=function(){console.log("Change number of page to "+c.itemNumOfPage),c.allItemsLength>0&&(c.currentPage=1,e())},c.previousPage=function(){console.log("Click previous button"),c.currentPage--,e()},c.nextPage=function(){console.log("Click next button"),c.currentPage++,e()}}),c.controller("otherUrlCtrl",function(){console.log("Otherwise URL contoller...")})}());